#!/bin/bash

CWD=`pwd`
ENF=$(cd $(dirname $0)/..;pwd)
PROJ=$CWD

# フレームワークファイルのコピー
if [ ! -f $PROJ/index.php ]; then
	echo "ERROR: This project is static mode."
	exit
fi

cp -af $ENF/index.php $PROJ/
cp -af $ENF/extlib/* $PROJ/extlib/
cp -af $ENF/lib/*.png $PROJ/lib/

cp -af $ENF/lib/htaccess.noindexes $PROJ/media/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/media/picture/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/media/sound/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/media/model/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/sysobject/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/usrobject/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/plugins/.htaccess
cp -af $ENF/lib/htaccess.noindexes $PROJ/extlib/.htaccess
cp -af $ENF/lib/htaccess.noaccess $PROJ/lib/.htaccess
cp -af $ENF/lib/htaccess.noaccess $PROJ/src/.htaccess

# enchantライブラリ生成
coffee -b -j $PROJ/sysobject/enforce.core.js -c $ENF/lib/_originObject.coffee $ENF/lib/_stationary.coffee $ENF/lib/library.coffee $ENF/lib/main.coffee $ENF/plugins/*.coffee
# tmlibライブラリ生成
coffee -b -j $PROJ/sysobject/enforce.core2.js -c $ENF/lib/_originObject.coffee $ENF/lib/_stationary2.coffee $ENF/lib/library.coffee $ENF/lib/main2.coffee $ENF/plugins/*.coffee
