#!/bin/bash

CWD=`pwd`
ENF=$(cd $(dirname $0)/..;pwd)
PROJ=$CWD

OLDIFS=$IFS
IFS=
exec < $PROJ/lib/version
echo ${version}
while read DATA
do
    version=$DATA
done
IFS=$OLDIFS
if [ "$version" != "1.0" ]; then
    echo "version unmatched."
    exit
fi

# フレームワークファイルのコピー
if [ ! -f $PROJ/index.php ]; then
	echo "ERROR: This project is static mode."
	exit
fi

cp -af $ENF/index.php $PROJ/
cp -af $ENF/extlib/* $PROJ/extlib/
coffee -b -j $PROJ/sysobject/enforce.core.js -c $ENF/lib/*.coffee

if [ "$1" == "-with-codit" ]; then
    if [ ! -f "$PROJ/lib/sqlite3.db" ]; then
        cp -af $ENF/lib/sqlite3.db $PROJ/lib/
    fi
    cp -af $ENF/codit $PROJ/
fi
