#!/usr/bin/php
<?php
$ini = parse_ini_file("lib/config.ini", true);
$library = $ini['ENVIRON']['LIBRARY'];
$eftmp = dirname(__FILE__);

// enforce system directory
$ENF = realpath("$eftmp/..");
// working directory
$PROJ = getcwd();

// check develop mode
if (!is_file("$PROJ/index.php")) {
    echo "It does not become a development mode.\n";
    exit;
}

// directory make
exec("mkdir -p $PROJ/lib");
exec("mkdir -p $PROJ/media/picture");
exec("mkdir -p $PROJ/media/sound");
exec("mkdir -p $PROJ/media/model");
exec("mkdir -p $PROJ/src");
exec("mkdir -p $PROJ/plugins");
exec("mkdir -p $PROJ/extlib");
exec("mkdir -p $PROJ/sysobject");
exec("mkdir -p $PROJ/usrobject");

// system file copy
exec("cp -af $ENF/index.php $PROJ/");
exec("cp -af $ENF/codit $PROJ/");
exec("cp -af $ENF/extlib/* $PROJ/extlib/");
exec("cp -af $ENF/lib/*.png $PROJ/lib/");
//exec("cp -af $ENF/media/picture/* $PROJ/media/picture/");
exec("cp -af $ENF/media/sound/* $PROJ/media/sound/");
exec("cp -af $ENF/media/model/* $PROJ/media/model/");

exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/media/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/media/picture/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/media/sound/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/media/model/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/extlib/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/sysobject/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/usrobject/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/plugins/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noindexes $PROJ/lib/.htaccess > /dev/null");
exec("cp -af $ENF/lib/htaccess.noaccess $PROJ/src/.htaccess > /dev/null");

if ($library == "enchant") {
    // enchantライブラリ生成
    echo "As for the library, enchant is chosen.\n";
    exec("coffee -b -j $PROJ/sysobject/enforce.core.js -c $ENF/lib/_originObject.coffee $ENF/lib/_stationary.enchant.coffee $ENF/lib/_vanalogpad.coffee $ENF/lib/_vgamebutton.coffee $ENF/lib/_vgamepadcontrol.coffee $ENF/lib/_dispImageStrings.coffee $ENF/lib/main.enchant.coffee $ENF/plugins/*.coffee");
} else if ($library == "tmlib") {
    echo "As for the library, tmlib is chosen.\n";
    // tmlibライブラリ生成
    exec("coffee -b -j $PROJ/sysobject/enforce.core.js -c $ENF/lib/_originObject.coffee $ENF/lib/_stationary.tmlib.coffee $ENF/lib/_vanalogpad.coffee $ENF/lib/_vgamebutton.coffee $ENF/lib/_vgamepadcontrol.coffee $ENF/lib/_dispImageStrings.coffee $ENF/lib/main.tmlib.coffee $ENF/plugins/*.coffee");
}
// 共用ライブラリコンパイル
exec("coffee -b -j $PROJ/sysobject/library.js -c $ENF/lib/library.coffee");
?>
